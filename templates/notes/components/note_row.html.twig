{% set note = note ?? {} %}
{% set editUrl = note.editUrl ?? '#' %}
{% set publicUrl = note.publicUrl ?? null %}
{% set publicHref = publicUrl ? ((publicUrl|slice(0, 4) == 'http') ? publicUrl : app.request.schemeAndHttpHost ~ publicUrl) : null %}
{% set openHref = publicHref ?? editUrl %}
{% set isShared = note.isShared|default(false) %}
{% set isPublic = note.visibility|lower == 'public' %}

<article class="group px-4 sm:px-5 py-5 hover:bg-slate-50 transition-colors">
    <div class="flex gap-4 items-start">
        <div class="flex-1 space-y-3">
            <div class="flex flex-wrap items-center gap-2">
                <div class="inline-flex items-center gap-2">
                    {% if isShared %}
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-sky-50 text-sky-700 border border-sky-200">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5z"/>
                            </svg>
                            For Me
                        </span>
                    {% elseif isPublic %}
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-50 text-emerald-700 border border-emerald-200">
                            <svg class="w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                            </svg>
                            Publiczne
                        </span>
                    {% else %}
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-rose-50 text-rose-700 border border-rose-200">
                            <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 11c.943 0 1.774.547 2.165 1.35a2.5 2.5 0 11-4.33 0A2.5 2.5 0 0112 11z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 11V7a5 5 0 00-10 0v4M5 11h14v7a2 2 0 01-2 2H7a2 2 0 01-2-2v-7z"/>
                            </svg>
                            Prywatne
                        </span>
                    {% endif %}

                    <a href="{{ openHref }}" {% if publicHref %}target="_blank" rel="noopener noreferrer"{% endif %} class="text-xs text-indigo-600 hover:text-indigo-700 font-medium inline-flex items-center gap-1">
                        Otw√≥rz
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </a>
                </div>
            </div>

            <h3 class="text-lg font-semibold text-slate-900 break-words">
                {{ note.title is not empty ? note.title : '(Bez tytu≈Çu)' }}
            </h3>

            <p class="text-sm text-slate-600 line-clamp-2 break-words">{{ note.excerpt }}</p>

            {% if note.labels is defined and note.labels is not empty %}
                <div class="flex flex-wrap gap-2">
                    {% for label in note.labels %}
                        <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-slate-50 text-slate-700 border border-slate-200">{{ label }}</span>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="flex items-center gap-2 self-start shrink-0">
            <a href="{{ editUrl }}" class="inline-flex items-center justify-center rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100 transition-colors" title="Edytuj">
                ‚úèÔ∏è
            </a>
            <button type="button"
                    data-delete-note
                    data-note-id="{{ note.id }}"
                    data-note-title="{{ note.title|default('(Bez tytu≈Çu)') }}"
                    data-delete-url="{{ note.deleteUrl }}"
                    class="inline-flex items-center justify-center rounded-lg border border-red-200 bg-red-50 px-3 py-2 text-sm font-semibold text-red-700 hover:bg-red-100 transition-colors"
                    title="Usu≈Ñ">
                üóëÔ∏è
            </button>
        </div>
    </div>

    <div class="flex items-center gap-2 text-xs text-slate-500 pt-4 mt-4 border-t border-slate-100">
        <span class="text-xs font-medium text-slate-600 bg-slate-100 px-2.5 py-1 rounded">ID {{ note.id }}</span>
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0 1 18 0z"/>
        </svg>
        <span>Utworzono: {{ note.createdAt|date('d.m.Y H:i:s') }}</span>
    </div>
</article>

