{#
  Note Edit Form Component
  Common form fields for creating and editing notes
  Props:
    - csrfToken (string)
    - initialTitle (string)
    - initialDescription (string)
    - initialLabels (array)
    - initialVisibility (string)
    - noteId (int) - null for create mode
    - submitUrl (string)
    - redirectUrl (string)
    - mode (string) - 'create' | 'edit'
#}
{% set formConfig = {
    mode: mode ?? 'create',
    noteId: noteId ?? null,
    submitUrl: submitUrl ?? '/api/notes',
    redirectUrl: redirectUrl ?? '/notes',
    initialTitle: initialTitle ?? '',
    initialDescription: initialDescription ?? '',
    initialLabels: initialLabels ?? [],
    initialVisibility: initialVisibility ?? 'private'
} %}

<form
    id="note-form"
    data-controller="note-form"
    data-note-form
    data-note-config="{{ formConfig|json_encode|e('html_attr') }}"
    class="space-y-8"
    novalidate
>
    <input type="hidden" name="csrf_token" value="{{ csrfToken }}" data-csrf-token>

    {# Validation Alert List - Global form errors #}
    <div id="form-errors" data-form-errors class="hidden">
        {% include 'notes/components/validation_alert_list.html.twig' %}
    </div>

    {# Title Field #}
    <div data-field="title">
        {% include 'notes/components/title_field.html.twig' with {
            initialTitle: formConfig.initialTitle
        } %}
    </div>

    {# Visibility Toggle #}
    <div data-field="visibility">
        {% include 'notes/components/visibility_toggle.html.twig' with {
            initialValue: formConfig.initialVisibility
        } %}
    </div>

    {# Public Link Section #}
    {% include 'notes/components/public_link.html.twig' with {
        publicUrl: publicUrl ?? null,
        visibility: initialVisibility ?? 'private'
    } %}

    {# Markdown Textarea #}
    <div data-field="description">
        {% include 'notes/components/markdown_textarea.html.twig' with {
            initialDescription: formConfig.initialDescription
        } %}
    </div>

    {# Tag Input #}
    <div data-field="labels">
        {% include 'notes/components/tag_input.html.twig' with {
            initialLabels: formConfig.initialLabels
        } %}
    </div>
</form>
