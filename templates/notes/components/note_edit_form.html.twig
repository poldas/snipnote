{#
  Note Edit Form Component
  Common form fields for creating and editing notes
  Props:
    - csrfToken (string)
    - initialTitle (string)
    - initialDescription (string)
    - initialLabels (array)
    - initialVisibility (string)
    - noteId (int) - null for create mode
    - submitUrl (string)
    - redirectUrl (string)
    - previewUrl (string)
    - mode (string) - 'create' | 'edit'
#}
{% set formConfig = {
    mode: mode ?? 'create',
    noteId: noteId ?? null,
    submitUrl: submitUrl ?? '/api/notes',
    redirectUrl: redirectUrl ?? '/notes',
    previewUrl: previewUrl ?? '/api/notes/preview',
    initialTitle: initialTitle ?? '',
    initialDescription: initialDescription ?? '',
    initialLabels: initialLabels ?? [],
    initialVisibility: initialVisibility ?? 'private'
} %}

<form
    id="note-form"
    data-controller="note-form"
    data-note-form
    data-note-config="{{ formConfig|json_encode|e('html_attr') }}"
    class="space-y-8"
    novalidate
>
    <input type="hidden" name="csrf_token" value="{{ csrfToken }}" data-csrf-token>

    {# Validation Alert List - Global form errors #}
    <div id="form-errors" data-form-errors class="hidden">
        <div role="alert" aria-live="assertive" class="bg-gradient-to-r from-red-500 to-pink-500 border-0 rounded-2xl p-5 shadow-xl">
            <div class="flex items-start gap-4">
                <span class="text-white text-3xl flex-shrink-0">⚠️</span>
                <div class="flex-1 text-white">
                    <h3 class="font-bold text-lg mb-3">Wystąpiły błędy walidacji</h3>
                    <ul data-error-list class="space-y-2 text-sm font-medium"></ul>
                </div>
            </div>
        </div>
    </div>

    {# Title Field #}
    <div data-field="title">
        {% include 'notes/components/title_field.html.twig' with {
            initialTitle: formConfig.initialTitle
        } %}
    </div>

    {# Visibility Toggle #}
    <div data-field="visibility">
        {% include 'notes/components/visibility_toggle.html.twig' with {
            initialValue: formConfig.initialVisibility
        } %}
    </div>

    {# Markdown Textarea #}
    <div data-field="description">
        {% include 'notes/components/markdown_textarea.html.twig' with {
            initialDescription: formConfig.initialDescription
        } %}
    </div>

    {# Tag Input #}
    <div data-field="labels">
        {% include 'notes/components/tag_input.html.twig' with {
            initialLabels: formConfig.initialLabels
        } %}
    </div>

    {# Preview Section (hidden by default, shown after preview request) #}
    <div
        id="preview-section"
        data-preview-section
        class="hidden border-t border-slate-200 pt-6"
    >
        <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-semibold text-slate-900">Podgląd</h3>
            <button
                type="button"
                data-close-preview
                class="text-sm text-slate-600 hover:text-slate-900"
                aria-label="Zamknij podgląd"
            >
                ✕ Zamknij
            </button>
        </div>
        <div
            id="preview-content"
            data-preview-content
            class="prose prose-slate max-w-none bg-slate-50 rounded-lg p-6 border border-slate-200"
        >
            {# Preview HTML will be inserted here #}
        </div>
    </div>
</form>
