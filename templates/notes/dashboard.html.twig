{% extends 'base.html.twig' %}

{% block title %}Twoje notatki | Snipnote{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/dist/notes.css') }}">
    <style>
        #toast-stack {
            top: 102px; /* 100px header height + 2px gap */
        }
    </style>
{% endblock %}

{% block body %}
    {% set layoutData = {
        subtitle: 'Twórz i udostępniaj notatki',
        currentUserEmail: app.user.email ?? 'użytkownik',
        showAddBtn: true,
        container_class: 'max-w-7xl mx-auto px-4 sm:px-6 py-6 sm:py-8'
    } %}

    {% set content %}
        <!-- Search Bar -->
        <div class="mb-6 sm:mb-8">
            {% include 'notes/components/topbar_search.html.twig' with {
                q: view.q,
                parsed: view.parsedQ,
                isLoading: view.isLoading,
                count: view.meta.total|default(0),
                visibility: view.visibility|default('')
            } %}
        </div>

        <!-- Filter Bar Info -->
        <div class="flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 sm:gap-0 mb-6">
            <div class="flex items-center gap-2 self-end sm:self-auto">
                <span class="text-slate-600 font-medium">Znalezionych notatek:</span>
                <span class="px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full font-bold text-sm">{{ view.meta.total|default(0) }}</span>
            </div>
        </div>

        <!-- Notes Gallery Grid -->
        {% set parsed = view.parsedQ ?? { labels: [], text: null } %}
        {% include 'notes/components/notes_panel.html.twig' with {
            notes: view.notes,
            meta: view.meta,
            q: view.q,
            labels: parsed.labels,
            visibility: view.visibility|default(''),
            error: view.error,
            isLoading: view.isLoading
        } %}

        {# Universal Confirmation Modal #}
        {% include 'notes/components/confirm_modal.html.twig' %}
    {% endset %}

    {% include 'notes/components/notes_layout.html.twig' with { content: content } + layoutData %}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}