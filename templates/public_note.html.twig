{% extends 'base.html.twig' %}

{% block title %}{{ note.title ?? '(Bez tytułu)' }}{% endblock %}

{% block stylesheets %}
    <style>
        :root {
            --pn-bg: #e8eaf6;
            --pn-surface: rgba(255, 255, 255, 0.9);
            --pn-border: #e2e8f0;
            --pn-shadow: 0 24px 60px rgba(15, 23, 42, 0.12);
            --pn-primary: #1d4ed8;
            --pn-primary-strong: #0f172a;
            --pn-accent: #06b6d4;
            --pn-text: #0f172a;
            --pn-muted: #475569;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color: var(--pn-text);
            background:
                radial-gradient(circle at 15% 20%, rgba(102, 126, 234, 0.18), transparent 36%),
                radial-gradient(circle at 80% 15%, rgba(210, 153, 194, 0.16), transparent 32%),
                radial-gradient(circle at 70% 80%, rgba(109, 213, 237, 0.16), transparent 34%),
                linear-gradient(135deg, #e8eaf6 0%, #f3e5f5 50%, #e1f5fe 100%);
        }

        img,
        video,
        svg,
        canvas {
            max-width: 100%;
            height: auto;
        }

        a {
            color: inherit;
            text-decoration: none;
        }

        main.public-note {
            min-height: 100vh;
            padding: 64px 16px;
        }

        @media (min-width: 640px) {
            main.public-note {
                padding: 96px 24px;
            }
        }

        @media (min-width: 1024px) {
            main.public-note {
                padding: 35px 32px;
            }
        }

        .public-note__container {
            position: relative;
            max-width: 960px;
            margin: 0 auto;
            padding: 0 8px;
        }

        @media (min-width: 640px) {
            .public-note__container {
                padding: 0 16px;
            }
        }

        #public-note-shell {
            width: 100%;
        }

        .pn-shell {
            display: flex;
            flex-direction: column;
            gap: 24px;
            align-items: center;
        }

        .pn-card {
            width: 100%;
            background: var(--pn-surface);
            border: 1px solid rgba(226, 232, 240, 0.9);
            border-radius: 28px;
            box-shadow: var(--pn-shadow);
            padding: 28px;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            overflow-wrap: anywhere;
        }

        @media (min-width: 640px) {
            .pn-card {
                padding: 40px;
            }
        }

        .pn-brand {
            display: flex;
            justify-content: flex-start;
            width: 100%;
            margin-bottom: 18px;
        }

        .pn-logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 0;
            border-radius: 12px;
            background: transparent;
            border: none;
            color: var(--pn-primary-strong);
            text-decoration: none;
            font-weight: 700;
            box-shadow: none;
            transition: color 120ms ease, transform 120ms ease;
        }

        .pn-logo:hover,
        .pn-logo:focus-visible {
            color: #1e3a8a;
            transform: translateY(-1px);
        }

        .pn-logo__mark {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: #fff;
            font-weight: 800;
            font-size: 18px;
            box-shadow: 0 10px 24px rgba(102, 126, 234, 0.28);
        }

        .pn-logo__text {
            display: flex;
            flex-direction: column;
            line-height: 1.1;
        }

        .pn-logo__title {
            color: #312e81; /* indigo-900 */
            font-size: 18px;
            font-weight: 600;
        }

        .pn-logo__subtitle {
            color: rgba(67, 56, 202, 0.8); /* indigo-700/80 */
            font-size: 14px;
            font-weight: 400;
            opacity: 1;
        }

        /* Utility brand bar (mirrors home / notes header styles) */
        .pn-auth-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 40px;
        }

        .pn-auth-logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            color: #1e293b;
            text-decoration: none;
            transition: color 120ms ease, transform 120ms ease;
        }

        .pn-auth-logo:hover,
        .pn-auth-logo:focus-visible {
            color: #0f172a;
            transform: translateY(-1px);
        }

        .pn-auth-logo__mark {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: #fff;
            font-weight: 800;
            font-size: 18px;
            box-shadow: 0 10px 24px rgba(102, 126, 234, 0.28);
        }

        .pn-auth-logo__title {
            font-weight: 600;
            color: #312e81; /* indigo-900 */
            line-height: 1.1;
            font-size: 18px;
        }

        .pn-auth-logo__subtitle {
            font-size: 14px;
            color: rgba(67, 56, 202, 0.8); /* indigo-700/80 */
            line-height: 1.2;
            font-weight: 400;
        }

        .pn-meta-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .pn-date-pill {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-weight: 600;
            font-size: 13px;
            color: #475569;
            box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
        }

        .pn-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            color: currentColor;
        }

        h1 {
            margin: 14px 0 18px;
            font-size: 36px;
            line-height: 1.15;
            font-weight: 700;
            color: var(--pn-text);
        }

        @media (min-width: 640px) {
            h1 {
                font-size: 44px;
            }
        }

        .pn-labels {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 0 0 14px;
        }

        .pn-label {
            color: #2563eb;
            font-size: 13px;
            font-weight: 600;
            letter-spacing: 0.01em;
            padding: 0;
            border: none;
            background: none;
            box-shadow: none;
        }

        .pn-content {
            margin-top: 6px;
        }

        article.prose {
            line-height: 1.75;
            font-size: 16px;
            color: var(--pn-text);
            word-break: break-word;
        }

        article.prose p {
            margin: 0 0 1em;
            color: var(--pn-text);
        }

        article.prose h2 {
            margin: 1.4em 0 0.6em;
            font-size: 24px;
        }

        article.prose h3 {
            margin: 1.2em 0 0.5em;
            font-size: 20px;
        }

        article.prose ul,
        article.prose ol {
            margin: 0 0 1em 1.4em;
        }

        article.prose blockquote {
            margin: 0 0 1.2em;
            padding: 12px 16px;
            border-left: 4px solid #e0e7ff;
            background: rgba(255, 255, 255, 0.7);
            color: var(--pn-muted);
            border-radius: 12px;
        }

        article.prose img,
        article.prose video,
        article.prose iframe {
            max-width: 100%;
            height: auto;
        }

        article.prose pre {
            background: #0f172a;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 16px;
            overflow: auto;
        }

        .pn-support-wrap {
            width: 100%;
            text-align: center;
        }

        .pn-support {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 12px 18px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid var(--pn-border);
            color: var(--pn-muted);
            border-radius: 999px;
            font-weight: 500;
            box-shadow: 0 12px 30px rgba(15, 23, 42, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .pn-support .pn-icon {
            color: var(--pn-primary-strong);
            opacity: 0.8;
        }

        /* Error state */
        .pn-error {
            position: relative;
            overflow: hidden;
            border-radius: 28px;
            border: 1px solid rgba(226, 232, 240, 0.9);
            background: linear-gradient(140deg, rgba(232, 234, 246, 0.75), rgba(243, 229, 245, 0.78), rgba(225, 245, 254, 0.78));
            box-shadow: var(--pn-shadow);
            padding: 28px;
        }

        @media (min-width: 640px) {
            .pn-error {
                padding: 44px;
                border-radius: 32px;
            }
        }

        .pn-error__glow {
            position: absolute;
            filter: blur(44px);
            opacity: 0.4;
            animation: float 10s ease-in-out infinite;
            pointer-events: none;
        }

        .pn-error__glow--1 {
            width: 280px;
            height: 280px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.85), transparent 55%);
            top: -60px;
            right: -40px;
        }

        .pn-error__glow--2 {
            width: 220px;
            height: 220px;
            background: radial-gradient(circle, rgba(109, 213, 237, 0.75), transparent 55%);
            bottom: -50px;
            left: -30px;
            animation-delay: 1.5s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }

        .pn-error__card {
            position: relative;
            display: grid;
            gap: 16px;
            max-width: 720px;
        }

        .pn-error__icon {
            width: 64px;
            height: 64px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 18px;
            background: #fff;
            border: 1px solid #e2e8f0;
            font-size: 26px;
            box-shadow: 0 16px 38px rgba(15, 23, 42, 0.12);
            animation: bounce 2.4s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        .pn-error__content {
            display: grid;
            gap: 10px;
        }

        .pn-error__eyebrow {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #475569;
            margin: 0;
        }

        .pn-error__title {
            margin: 0;
            font-size: 26px;
            line-height: 1.25;
            color: var(--pn-primary-strong);
        }

        .pn-error__desc {
            margin: 0;
            color: #475569;
            font-size: 15px;
            line-height: 1.7;
        }

        .pn-error__actions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 6px;
        }

        .pn-error__btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 14px;
            border: 1px solid transparent;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: transform 120ms ease, box-shadow 140ms ease, background-color 140ms ease, color 140ms ease, border-color 140ms ease;
            text-decoration: none;
        }

        .pn-error__btn--primary {
            background: #1d4ed8;
            color: #fff;
            border-color: #1d4ed8;
            box-shadow: 0 12px 28px rgba(37, 99, 235, 0.28);
        }

        .pn-error__btn--primary:hover,
        .pn-error__btn--primary:focus-visible {
            background: #1e40af;
            border-color: #1e40af;
            transform: translateY(-1px);
            box-shadow: 0 14px 32px rgba(30, 64, 175, 0.32);
        }

        .pn-error__btn--ghost {
            background: rgba(255, 255, 255, 0.8);
            color: var(--pn-primary-strong);
            border-color: #e2e8f0;
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.08);
        }

        .pn-error__btn--ghost:hover,
        .pn-error__btn--ghost:focus-visible {
            background: #fff;
            color: #1e40af;
            transform: translateY(-1px);
            box-shadow: 0 12px 28px rgba(15, 23, 42, 0.12);
        }

        @media (max-width: 480px) {
            body {
                font-size: 15px;
            }

            main.public-note {
                padding: 48px 12px;
            }

            .pn-card {
                padding: 22px;
                border-radius: 22px;
            }

            .pn-meta-row {
                gap: 8px;
            }

            .pn-date-pill {
                width: 100%;
                justify-content: center;
                font-size: 12px;
            }

            h1 {
                font-size: 28px;
                line-height: 1.2;
                margin: 10px 0 14px;
            }

            .pn-labels {
                gap: 8px;
            }

            article.prose {
                font-size: 15px;
                line-height: 1.65;
            }

            article.prose pre {
                font-size: 13px;
                padding: 14px 12px 12px;
            }
        }
    </style>
{% endblock %}

{% block body %}
<main class="public-note">
    <section class="public-note__container">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-6 pb-4">
            <header class="pn-auth-header">
                <a href="/" data-test-id="logo-home-link" class="pn-auth-logo">
                    <span class="pn-auth-logo__mark">S</span>
                    <div class="pn-auth-logo__text">
                        <div class="pn-auth-logo__title">Snipnote</div>
                        <div class="pn-auth-logo__subtitle">Twórz i udostępniaj notatki</div>
                    </div>
                </a>
                <div>
                    {% block auth_nav %}{% endblock %}
                </div>
            </header>
        </div>
        {% if errorCode is not null %}
            {% include 'components/public_note_error.html.twig' with { errorCode: errorCode } %}
        {% elseif note is defined and note %}
            <div id="public-note-shell" class="pn-shell">
                <div class="pn-card">
                    <div class="pn-meta-row">
                        <div class="pn-date-pill">
                            <span class="pn-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </span>
                            <time datetime="{{ note.createdAt|date('c') }}">
                                {{ note.createdAt|date('d M Y') }}
                            </time>
                        </div>
                    </div>
                    <h1>
                        {{ note.title is not empty ? note.title : '(Bez tytułu)' }}
                    </h1>

                    {% if note.labels|length %}
                        <div class="pn-labels" aria-label="Etykiety notatki">
                            {% for label in note.labels %}
                                <span class="pn-label">#{{ label }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <article class="pn-content prose" data-htmx-target="this">
                        {% if note.descriptionHtml is not empty %}
                            {{ note.descriptionHtml|raw }}
                        {% else %}
                            <p class="text-slate-500">(Brak treści)</p>
                        {% endif %}
                    </article>
                </div>
            </div>
        {% endif %}
    </section>
</main>
{% block javascripts %}
    <script>
        (function () {
            const article = document.querySelector('article[data-htmx-target]');
            if (!article) return;
            const blocks = article.querySelectorAll('pre > code');
            blocks.forEach((codeEl) => {
                const pre = codeEl.parentElement;
                if (!pre) return;
                pre.style.position = 'relative';
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = 'Kopiuj';
                button.style.position = 'absolute';
                button.style.right = '12px';
                button.style.top = '12px';
                button.style.padding = '6px 10px';
                button.style.borderRadius = '999px';
                button.style.border = 'none';
                button.style.background = '#0f172a';
                button.style.color = '#fff';
                button.style.fontSize = '12px';
                button.style.fontWeight = '600';
                button.style.boxShadow = '0 6px 18px rgba(15,23,42,0.28)';
                button.style.cursor = 'pointer';
                button.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(codeEl.innerText);
                        button.textContent = 'Skopiowano';
                        setTimeout(() => (button.textContent = 'Kopiuj'), 1500);
                    } catch (e) {
                        button.textContent = 'Błąd';
                        setTimeout(() => (button.textContent = 'Kopiuj'), 1500);
                    }
                });
                pre.appendChild(button);
            });
        })();
    </script>
{% endblock %}
{% endblock %}

