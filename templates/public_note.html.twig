{% extends 'base.html.twig' %}

{% block title %}{{ note.title ?? '(Bez tytułu)' }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('public_note.css') }}">
{% endblock %}

{% block body %}
<main class="public-note">
    <section class="public-note__container">
        <div class="max-w-6xl mx-auto px-4 pt-4 sm:pt-6 pb-4">
            <header class="pn-auth-header">
                {% include 'components/logo.html.twig' with {size: 'small'} %}
                <div>
                    {% block auth_nav %}{% endblock %}
                </div>
            </header>
        </div>
        {% if errorCode is not null %}
            {% include 'components/public_note_error.html.twig' with { errorCode: errorCode } %}
        {% elseif note is defined and note %}
            <div id="public-note-shell" class="pn-shell">
                <div class="pn-card">
                    <div class="pn-meta-row">
                        <div class="pn-date-pill">
                            <span class="pn-icon" aria-hidden="true">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                </svg>
                            </span>
                            <time datetime="{{ note.createdAt|date('c') }}">
                                {{ note.createdAt|date('d M Y') }}
                            </time>
                        </div>
                    </div>
                    <h1>
                        {{ note.title is not empty ? note.title : '(Bez tytułu)' }}
                    </h1>

                    {% if note.labels|length %}
                        <div class="pn-labels" aria-label="Etykiety notatki">
                            {% for label in note.labels %}
                                <span class="pn-label">#{{ label }}</span>
                            {% endfor %}
                        </div>
                    {% endif %}

                    <article class="pn-content prose" data-htmx-target="this">
                        {% if note.descriptionHtml is not empty %}
                            {{ note.descriptionHtml|raw }}
                        {% else %}
                            <p class="text-slate-500">(Brak treści)</p>
                        {% endif %}
                    </article>
                </div>
            </div>
        {% endif %}
    </section>
</main>
{% block javascripts %}
    <script>
        (function () {
            const article = document.querySelector('article[data-htmx-target]');
            if (!article) return;
            const blocks = article.querySelectorAll('pre > code');
            blocks.forEach((codeEl) => {
                const pre = codeEl.parentElement;
                if (!pre) return;
                pre.style.position = 'relative';
                const button = document.createElement('button');
                button.type = 'button';
                button.textContent = 'Kopiuj';
                button.style.position = 'absolute';
                button.style.right = '12px';
                button.style.top = '12px';
                button.style.padding = '6px 10px';
                button.style.borderRadius = '999px';
                button.style.border = 'none';
                button.style.background = '#0f172a';
                button.style.color = '#fff';
                button.style.fontSize = '12px';
                button.style.fontWeight = '600';
                button.style.boxShadow = '0 6px 18px rgba(15,23,42,0.28)';
                button.style.cursor = 'pointer';
                button.addEventListener('click', async () => {
                    try {
                        await navigator.clipboard.writeText(codeEl.innerText);
                        button.textContent = 'Skopiowano';
                        setTimeout(() => (button.textContent = 'Kopiuj'), 1500);
                    } catch (e) {
                        button.textContent = 'Błąd';
                        setTimeout(() => (button.textContent = 'Kopiuj'), 1500);
                    }
                });
                pre.appendChild(button);
            });
        })();
    </script>
{% endblock %}
{% endblock %}

