{% extends 'base.html.twig' %}

{% block title %}{{ note.title ?? '(Bez tytu≈Çu)' }}{% endblock %}

{#
    SEKCJA: Dynamiczne Style (Theme Switching)
    ------------------------------------------
    Logika ta pozwala na zmianƒô wyglƒÖdu ca≈Çej strony bez zmiany struktury HTML.
    1. ZAWSZE ≈Çadujemy `public.css` - zawiera on style bazowe, reset, Tailwind utilities oraz style dla Logo.
    2. WARUNKOWO ≈Çadujemy style tematyczne (recipe/todo) - nadpisujƒÖ one zmienne CSS (kolory) i
       dostosowujƒÖ wyglƒÖd komponent√≥w (.pn-card, typography) do specyfiki danej tre≈õci.
#}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('styles/dist/public.css') }}">
    {% if theme is defined and theme == 'recipe' %}
        <link rel="stylesheet" href="{{ asset('styles/recipe_view.css') }}">
    {% elseif theme is defined and theme == 'todo' %}
        <link rel="stylesheet" href="{{ asset('styles/todo_view.css') }}">
    {% endif %}
{% endblock %}

{% block body %}
<main class="public-note">
    <section class="public-note__container">
        <div class="max-w-6xl mx-auto px-4 pt-4 sm:pt-6 pb-4">
            <header class="pn-auth-header">
                {# Komponent Logo: Stylizowany przez Tailwind w public.css #}
                {% include 'components/logo.html.twig' with {size: 'small'} %}
                <div>
                    {% block auth_nav %}{% endblock %}
                </div>
            </header>
        </div>
        {% if errorCode is not null %}
            {% include 'components/public_note_error.html.twig' with { errorCode: errorCode } %}
        {% elseif note is defined and note %}
            {#
                G≈Å√ìWNY KONTENER NOTATKI (.pn-shell)
                -----------------------------------
                To jest wsp√≥lna struktura dla wszystkich widok√≥w.
                Style tematyczne (recipe/todo) celujƒÖ w klasy:
                - .pn-card: G≈Ç√≥wna karta (t≈Ço, cie≈Ñ, border)
                - .pn-date-pill: Stylizacja daty
                - h1: Tytu≈Ç notatki
                - .pn-labels / .pn-label: Tagi
                - article.prose: Wyrenderowana tre≈õƒá Markdown
            #}
            <div id="public-note-shell" class="pn-shell" {% if theme == 'todo' %}data-controller="public-todo"{% endif %}>
                <div class="pn-card">
                    {% if theme == 'todo' %}
                        <div class="todo-header">
                            <h1>üìã {{ note.title is not empty ? note.title : '(Bez tytu≈Çu)' }}</h1>
                            <p>Dodawaj, zaznaczaj i usuwaj zadania z listy</p>
                            <div class="todo-stats">
                                <div class="stat-badge">
                                    <span class="emoji">üìù</span>
                                    <span>Wszystkich: <span data-public-todo-target="totalCount">0</span></span>
                                </div>
                                <div class="stat-badge">
                                    <span class="emoji">‚úÖ</span>
                                    <span>Gotowe: <span data-public-todo-target="completedCount">0</span></span>
                                </div>
                                <div class="stat-badge">
                                    <span class="emoji">‚è≥</span>
                                    <span>Do zrobienia: <span data-public-todo-target="pendingCount">0</span></span>
                                </div>
                            </div>
                        </div>

                        <div class="todo-add-section">
                            <div class="todo-input-wrapper">
                                <input 
                                    type="text" 
                                    data-public-todo-target="input"
                                    class="todo-input" 
                                    placeholder="Dodaj nowe zadanie..."
                                    autocomplete="off"
                                    data-action="keypress->public-todo#add"
                                >
                                <button class="btn-add" data-action="click->public-todo#add">
                                    <span>‚ûï</span>
                                    <span>Dodaj</span>
                                </button>
                            </div>
                        </div>

                        <div data-public-todo-target="list" class="todo-list-interactive">
                            {# Interaktywna lista renderowana przez JS na podstawie Markdowna #}
                        </div>
                    {% else %}
                        <div class="pn-meta-row">
                            <div class="pn-date-pill">
                                <span class="pn-icon" aria-hidden="true">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                </span>
                                <time datetime="{{ note.createdAt|date('c') }}">
                                    {{ note.createdAt|date('d M Y') }}
                                </time>
                            </div>
                        </div>
                        <h1>
                            {{ note.title is not empty ? note.title : '(Bez tytu≈Çu)' }}
                        </h1>

                        {% if note.labels|length %}
                            <div class="pn-labels" aria-label="Etykiety notatki">
                                {% for label in note.labels %}
                                    <span class="pn-label">#{{ label }}</span>
                                {% endfor %}
                            </div>
                        {% endif %}
                    {% endif %}

                    <article class="pn-content prose" 
                             data-htmx-target="this"
                             {% if theme == 'todo' %}data-public-todo-target="markdownContent"{% endif %}>
                        {% if note.descriptionHtml is not empty %}
                            {{ note.descriptionHtml|raw }}
                        {% else %}
                            <p class="text-slate-500">(Brak tre≈õci)</p>
                        {% endif %}
                    </article>
                </div>
            </div>
        {% endif %}
    </section>
</main>
{% block javascripts %}
    {{ parent() }}
{% endblock %}
{% endblock %}

